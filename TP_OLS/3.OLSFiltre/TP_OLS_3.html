<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>API Geoportail - votre carte personnelle</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
		<style type="text/css">
	    <!--
		div#viewerDiv {
			width:800px;
			height:600px;
		}
		-->
		</style>
	</head>
	<body>
	    <h1 id="example_title">TP OLS3</h1>
		<div id="viewerDiv"></div>
		
		<script type="text/javascript">
		
			var iv=null;
			var viewer=null;
			
			function initMap(){

				// Récupération du visualiseur à partir de l'interfaceViewer
				viewer=iv.getViewer();
				
				// 1) Création d'une couche OpenLs
		
				// 2) ajout de cette couche à la carte

				// 3) Surcharge du controle Geoportal.Control.LocationUtilityService.GeoNames
				
				var MyGeoNames= OpenLayers.Class( Geoportal.Control.LocationUtilityService.GeoNames, {
				  LUSSuccess: function(request) {					
				    
				    // a) Récupération du tableau des features résultant de la requête
				    
				    // b) Création d'un nouveau tableau filtré qui va remplacer le tableau features
				   
				    /*var filteredFeatures= new Array()  ;
                                    for (var i= 0, ilen= features.length; i<ilen; i++) {
                                      var f= features[i];
                                      console.log(f.attributes.address);
                                      for (var j = 0; j< f.attributes.address.places.length; j++){
                                        if (f.attributes.address.places[j].classification=="Nature"){
                                                if (f.attributes.address.places[j].name=="Commune"){
                                                        filteredFeatures.push(f.clone()) ;
                                                        break;
                                                }
                                        }
                                      }
                                    }*/
				    
				    // c) Remplacement du tableau features de queriedAddresses par filteredFeatures

                                    // d) héritage				
				    /*if (Geoportal.Control.LocationUtilityService.GeoNames.prototype.LUSSuccess.apply(this,arguments)===false) {
				    	return false;
				    }*/
				    
				  }
				}) ;

				// 4) Création d'une instance du nouveau contrôle créé myctrl qui prend entrée la couche toponymLayer

				// 5) Ajout de ce contrôle à la carte

				// 6) Activation du contrôle


			}

			
			//au chargement de la page, cette fonction est déclenchée
			window.onload= function() {    	
			
				//initialisation du loader
				//La méthode Geoportal.load va retourner un objet interfaceViewer
				iv = Geoportal.load(
					// identifiant du conteneur de la carte
					'viewerDiv',
					// clé API
					['VOTRE_CLEF'],
					{// centre de la carte
				        lon:2.731525,
				        lat:45.833333
					},
					//zoom
					null,
					//options du loader
					{
						//fonction déclenchée une fois le visualisateur initialisé
						onView : initMap,
						//type du visualisateur voulu (par défaut Standard)
						viewerClass:Geoportal.Viewer.Default,
						proxyUrl:"../../proxy/proxyENSG.php?url="
					}
				);
			};

		</script>		
		<script type="text/javascript" src="http://api.ign.fr/geoportail/api/js/latest/GeoportalExtended.js"></script>
	</body>
</html>
